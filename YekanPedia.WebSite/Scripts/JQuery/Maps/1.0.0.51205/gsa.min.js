var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},gsa;(function(n){var t;(function(n){var t=function(){function n(n,t){this.code=n;this.name=t}return n.prototype.displayError=function(n){var i="["+(name?name+":":"")+this.code+"] ",t;return t=i+n.replace(/\{\d+\}/g,function(n){return n}),t+"\nhttp://cms.yekanPedia.org/map/51205/"+(this.name?this.name+"/":"")+this.code},n}(),r=function(n){function t(t,i){i===void 0&&(i="");n.call(this,t,name);this.code=t;this.message=i;this.name="MapOption"}return __extends(t,n),t.prototype.toString=function(){if(this.message=="")switch(this.code){case 40401:this.message="mapElement not found !";break;case 40405:this.message="the posiotion field parameter is not set !";break;case 50001:this.message="the posiotion field of MarkersOptions parameter is not set !";break;default:this.message="unhandled Exception!"}return n.prototype.displayError.call(this,this.message)},t}(t),i;n.MapOptionException=r;i=function(n){function t(t,i){i===void 0&&(i="");n.call(this,t,name);this.code=t;this.message=i;this.name="RemoteService"}return __extends(t,n),t.prototype.toString=function(){return n.prototype.displayError.call(this,this.message)},t}(t);n.RemoteServiceException=i})(t=n.bcl||(n.bcl={}))})(gsa||(gsa={})),function(n){var t;(function(t){var f=function(){function t(){}return t.toGoogleMapsZoomControlStyle=function(t){switch(t){case n.maps.ZoomControlStyle.DEFAULT:return google.maps.ZoomControlStyle.DEFAULT;case n.maps.ZoomControlStyle.LARGE:return google.maps.ZoomControlStyle.LARGE;case n.maps.ZoomControlStyle.SMALL:return google.maps.ZoomControlStyle.SMALL;default:return google.maps.ZoomControlStyle.DEFAULT}},t.toGoogleMapsControlPosition=function(t){switch(t){case n.maps.ControlPosition.BOTTOM_CENTER:return google.maps.ControlPosition.BOTTOM_CENTER;case n.maps.ControlPosition.BOTTOM_LEFT:return google.maps.ControlPosition.BOTTOM_LEFT;case n.maps.ControlPosition.BOTTOM_RIGHT:return google.maps.ControlPosition.BOTTOM_RIGHT;case n.maps.ControlPosition.LEFT_BOTTOM:return google.maps.ControlPosition.LEFT_BOTTOM;case n.maps.ControlPosition.LEFT_CENTER:return google.maps.ControlPosition.LEFT_CENTER;case n.maps.ControlPosition.LEFT_TOP:return google.maps.ControlPosition.LEFT_TOP;case n.maps.ControlPosition.RIGHT_BOTTOM:return google.maps.ControlPosition.RIGHT_BOTTOM;case n.maps.ControlPosition.RIGHT_CENTER:return google.maps.ControlPosition.RIGHT_CENTER;case n.maps.ControlPosition.RIGHT_TOP:return google.maps.ControlPosition.RIGHT_TOP;case n.maps.ControlPosition.TOP_CENTER:return google.maps.ControlPosition.TOP_CENTER;case n.maps.ControlPosition.TOP_LEFT:return google.maps.ControlPosition.TOP_LEFT;case n.maps.ControlPosition.TOP_RIGHT:return google.maps.ControlPosition.TOP_RIGHT;default:return google.maps.ControlPosition.BOTTOM_LEFT}},t.toGoogleMapsMapTypeId=function(t){switch(t){case n.maps.MapTypeId.HYBRID:return google.maps.MapTypeId.HYBRID;case n.maps.MapTypeId.ROADMAP:return google.maps.MapTypeId.ROADMAP;case n.maps.MapTypeId.SATELLITE:return google.maps.MapTypeId.SATELLITE;case n.maps.MapTypeId.TERRAIN:return google.maps.MapTypeId.TERRAIN;default:return google.maps.MapTypeId.ROADMAP}},t.toGoogleMapsLatLngObject=function(n){return new google.maps.LatLng(n.lat,n.lng)},t}(),i,r,u;t.TypeCasting=f;i=function(){function n(){}return n.isFunction=function(n){return n&&{}.toString.call(n)==="[object Function]"},n}();t.FunctionUtility=i;r=function(){function n(n){this.template=n}return n.prototype.render=function(n){var r="{{}}",e,i,u,f,t,o="/([$^\\/()|?+*[]{}.-])/g";return f=r.length,t=Math.ceil(f/2),i=r.substr(0,t).replace(o,"\\$1"),u=r.substr(t,f).replace(o,"\\$1")||i,e=new RegExp(i+"[^"+i+u+"]+"+u,"g"),this.template.replace(e,function(i){var f=i.slice(t,-t),e=f.split("."),r,u=0,o=e.length;if(f in n)r=n[f];else for(r=n;u<o;u++)if(e[u]in r)r=r[e[u]];else return i;return r})},n.prototype.getTemplate=function(){return this.template},n}();t.StringInterpolation=r;u=function(){function n(){if(n._instance)throw new Error("Error: Instantiation failed: Use UrlHelper.getInstance() instead of new.");n._instance=this}return n.getInstance=function(){return n._instance},n.prototype.getMyLocationMarkerIcon=function(){return"http://cms.yekanPedia.org/Content/Images/Map/MyLocationMarkerIcon.png"},n.prototype.getMarkers=function(n){return"http://cms.yekanPedia.org/Content/Images/Map/"+n},n._instance=new n,n}();t.UrlHelper=u})(t=n.util||(n.util={}))}(gsa||(gsa={})),function(n){var t;(function(t){var i=function(){function t(){}return t.FailureProxyCallback=function(t,i){throw new n.bcl.MapOptionException(60001,i);},t.SendRequest=function(n){var t=this;return n.error=function(n){t.FailureProxyCallback(this,n)},$.ajax(n)},t}();t.RemoteService=i})(t=n.net||(n.net={}))}(gsa||(gsa={})),function(n){var t;(function(t){var i=n.bcl,y,h,c,p,u,f,l,e,o,a,w,v,s,r;(function(n){n[n.HYBRID=0]="HYBRID";n[n.ROADMAP=1]="ROADMAP";n[n.SATELLITE=2]="SATELLITE";n[n.TERRAIN=3]="TERRAIN"})(t.MapTypeId||(t.MapTypeId={}));y=t.MapTypeId,function(n){n[n.BOTTOM_CENTER=0]="BOTTOM_CENTER";n[n.BOTTOM_LEFT=1]="BOTTOM_LEFT";n[n.BOTTOM_RIGHT=2]="BOTTOM_RIGHT";n[n.LEFT_BOTTOM=3]="LEFT_BOTTOM";n[n.LEFT_CENTER=4]="LEFT_CENTER";n[n.LEFT_TOP=5]="LEFT_TOP";n[n.RIGHT_BOTTOM=6]="RIGHT_BOTTOM";n[n.RIGHT_CENTER=7]="RIGHT_CENTER";n[n.RIGHT_TOP=8]="RIGHT_TOP";n[n.TOP_CENTER=9]="TOP_CENTER";n[n.TOP_LEFT=10]="TOP_LEFT";n[n.TOP_RIGHT=11]="TOP_RIGHT"}(t.ControlPosition||(t.ControlPosition={}));h=t.ControlPosition,function(n){n[n.DEFAULT=0]="DEFAULT";n[n.LARGE=1]="LARGE";n[n.SMALL=2]="SMALL"}(t.ZoomControlStyle||(t.ZoomControlStyle={}));c=t.ZoomControlStyle,function(n){n[n.BOUNCE=0]="BOUNCE";n[n.DROP=1]="DROP"}(t.Animation||(t.Animation={}));p=t.Animation;u=function(){function n(){}return n.getKey=function(n){return n=="Namayandegan"?this.Users:this.Student},n.Users={key:"Users",template:function(){return r.defaulAgency()},className:"blue"},n.Student={key:"Student",template:function(){return r.defaulAgency()},className:"yellow"},n}();t.KeyStore=u;f=function(){function t(){this.mapElement="mapElement";this.centerLatitude=35.696111;this.centerLongitude=51.423055999999995;this.zoom=14;this.mapTypeId=n.maps.MapTypeId.ROADMAP;this.zoomControl=!0;this.zoomControlStyle=c.DEFAULT;this.zoomControlPosition=h.LEFT_BOTTOM;this.setPointable=!1;this.setPointTemplate="\u0628\u0631\u0627\u06cc \u0628\u0631\u0648\u0632 \u0631\u0633\u0627\u0646\u06cc \u0645\u0646\u0637\u0642\u0647 \u062c\u063a\u0631\u0627\u0641\u06cc\u0627\u06cc\u06cc \u062e\u0648\u062f \u0628\u0631 \u0631\u0648\u06cc \u062f\u06a9\u0645\u0647 \u062b\u0628\u062a \u06a9\u0644\u06cc\u06a9 \u0646\u0645\u0627\u06cc\u06cc\u062f"}return t.prototype.findIndexKey=function(n){for(var t in this.keys)if(this.keys[t].key==n)return t;return-1},t}();t.MapOption=f;l=function(){function r(n){n===void 0&&(n=new f);this._mapOption=n}return r.prototype.load=function(){var r=this,u,f,o;try{if(t.CacheMarkers.getInstance().resetCache(),u=document.getElementById(this._mapOption.mapElement),u==null)throw new i.MapOptionException(40401,"#"+this._mapOption.mapElement+" element not found !");return n.util.FunctionUtility.isFunction(this._mapOption.onStart)&&this._mapOption.onStart(),this._mapObject=new google.maps.Map(u,{center:new google.maps.LatLng(this._mapOption.centerLatitude,this._mapOption.centerLongitude),zoom:this._mapOption.zoom,mapTypeId:n.util.TypeCasting.toGoogleMapsMapTypeId(this._mapOption.mapTypeId),zoomControlOptions:{style:n.util.TypeCasting.toGoogleMapsZoomControlStyle(this._mapOption.zoomControlStyle),position:n.util.TypeCasting.toGoogleMapsControlPosition(this._mapOption.zoomControlPosition)},mapTypeControl:!1,zoomControl:!0,panControl:!1}),this._mapOption.setPointable&&(f=new google.maps.Marker({map:this._mapObject,icon:n.util.UrlHelper.getInstance().getMyLocationMarkerIcon(),animation:google.maps.Animation.BOUNCE}),o=new google.maps.InfoWindow({content:this._mapOption.setPointTemplate}),google.maps.event.addListener(this._mapObject,"click",function(n){f.setPosition(n.latLng);o.close();o.open(r._mapObject,f);r._mapOption.onSetPoint(new s(n.latLng.lat(),n.latLng.lng()))})),new e(this._mapObject,this._mapOption)}catch(h){if(n.util.FunctionUtility.isFunction(this._mapOption.onError))this._mapOption.onError(h.message);throw new Error(h.toString());}finally{google.maps.event.addListener(this._mapObject,"tilesloaded",function(){n.util.FunctionUtility.isFunction(r._mapOption.onComplete)&&r._mapOption.onComplete()})}},r}();t.Map=l;e=function(){function f(t,i){var u=this,r;for(this._mapObject=t,this._mapOption=i,this._mapMarkers=[],console.log("Markers.ctor"),f._instance=this,r=0;r<(this._mapOption.keys?this._mapOption.keys.length:0);r++)n.net.RemoteService.SendRequest({url:n.util.UrlHelper.getInstance().getMarkers(this._mapOption.keys[r].key),type:"get",async:!0,dataType:"json",crossDomain:!0,cache:!0,success:function(n){u.addMarkerToMap(n,u._mapOption.findIndexKey(n.MarkerConfiguration.Key))}})}return f.prototype.setCenterPoint=function(t){if(t==null||typeof t=="undefined")throw new i.MapOptionException(40405);return this._mapObject.setCenter(n.util.TypeCasting.toGoogleMapsLatLngObject(t)),this},f.prototype.setMyLocation=function(t){var e=this,u;if(t.position==null)throw new i.MapOptionException(50001);return this._mylocationPoint=t.position,u=new google.maps.Marker({position:n.util.TypeCasting.toGoogleMapsLatLngObject(t.position),clickable:t.clickable,icon:t.icon||n.util.UrlHelper.getInstance().getMyLocationMarkerIcon(),draggable:t.dragable,raiseOnDrag:t.raiseOnDrag,visible:t.visible}),typeof t!="undefined"&&t.clickable==!0&&google.maps.event.addListener(u,"click",function(){f._infoWindow.close();f._infoWindow.setContent(t.template?t.template():r.myLocationTemplate());f._infoWindow.open(e._mapObject,u)}),u.setMap(this._mapObject),this},f.prototype.openInfoWindow=function(t){var e,o,r,u;if(t==null||typeof t=="undefined")throw new i.MapOptionException(40405);for(e=this._mapMarkers.length,o=n.util.TypeCasting.toGoogleMapsLatLngObject(t),r=0;r<e-1;r++)this._mapMarkers[r].getPosition().equals(o)&&(u=this._mapMarkers[r],f._infoWindow.close(),f._infoWindow.setOptions({maxWidth:300}),f._infoWindow.setContent(u.template),f._infoWindow.open(this._mapObject,u));return this},f.prototype.addMarkerToMap=function(t,i){for(var r,s,h=new n.util.StringInterpolation(this._mapOption.keys[i].template?this._mapOption.keys[i].template():u.getKey(this._mapOption.keys[i].key).template()),e=0;e<t.MarkerData.length;e++)r=t.MarkerData[e],s=new google.maps.Marker({position:new google.maps.LatLng(r.Latitude,r.Longitude),icon:t.MarkerConfiguration.IconAddress,map:this._mapObject,template:h.render(r),key:t.MarkerConfiguration.Key}),google.maps.event.addListener(s,"click",function(){f._infoWindow.close();f._infoWindow.setOptions({maxWidth:300});f._infoWindow.setContent(this.template);f._infoWindow.open(this.map,this)}),this._mapMarkers.push(s);o.getInstance().listFetchMarkers.push(t)},f.prototype.changeStateMarkers=function(n,i){for(var u=t.CacheMarkers.getInstance(),r=0;r<u.listFetchMarkers.length;r++)u.listFetchMarkers[r].MarkerConfiguration.Key==n&&(u.listFetchMarkers[r].MarkerConfiguration.Active=i);if(i)for(r=0;r<this._mapMarkers.length;r++)this._mapMarkers[r].getMap()==null&&this._mapMarkers[r].key==n&&this._mapMarkers[r].setMap(this._mapObject);else for(r=0;r<this._mapMarkers.length;r++)this._mapMarkers[r].key==n&&this._mapMarkers[r].setMap(null);return this},f._infoWindow=new google.maps.InfoWindow,f}();t.Markers=e;o=function(){function n(){if(this.listFetchMarkers=[],n._instance)throw new Error("Error: Instantiation failed: Use UrlHelper.getInstance() instead of new.");n._instance=this}return n.prototype.resetCache=function(){this.listFetchMarkers=[]},n.getInstance=function(){return n._instance},n.prototype.getAllKey=function(){for(var t=[],n=0;n<this.listFetchMarkers.length;n++)t.push(this.listFetchMarkers[n].MarkerConfiguration.Key);return t},n._instance=new n,n}();t.CacheMarkers=o;a=function(){function n(){}return n}();t.FetchMarkers=a;w=function(){function n(){}return n}();v=function(){function n(){}return n}();t.MarkerData=v;s=function(){function n(n,t){this.lat=n;this.lng=t}return n.prototype.toUrlValue=function(){return"lat="+this.lat.toString()+"&lng="+this.lng.toString()},n}();t.LatLng=s;r=function(){function n(){}return n.myLocationTemplate=function(){return"<div class='MarkerContent'>\u0645\u0648\u0642\u0639\u06cc\u062a \u0641\u0639\u0644\u06cc \u0634\u0645\u0627<\/div>"},n.defaulAgency=function(){return document.getElementById("defaultAgency").innerHTML},n}()})(t=n.maps||(n.maps={}))}(gsa||(gsa={}));Array.prototype.where=function(n,t){var r,u,i;for(t=t||window,r=[],u=this.length,i=0;i<u;i++)n.call(t,this[i],i,this)===!0&&r.push(this[i]);return r};Array.prototype.take=function(n,t){return t.slice(0,n)};